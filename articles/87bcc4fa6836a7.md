---
title: "System.IO.Compressionã®åœ§ç¸®çµæœãŒ.NET 4.5ä»¥é™ã¨ãã‚Œä»¥å‰ã§ç•°ãªã‚‹"
emoji: "ğŸ—œï¸"
type: "tech"
topics:
  - "dotnet"
  - "csharp"
published: true
published_at: "2021-12-28 03:06"
---

Qiita ã‚’é€€ä¼šã™ã‚‹ã«ã‚ãŸã£ã¦è¨˜äº‹ã®ç§»æ¤ã‚’ãŠã“ãªã„ã¾ã™ã€‚
å…ƒã¯2019å¹´03æœˆ20æ—¥ã«æŠ•ç¨¿ã—ã¾ã—ãŸã€‚
https://qiita.com/drafts/d7d09a91b468cd914ab9

## System.IO.Compressionã‚’ä½¿ã£ã¦åœ§ç¸®

ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã§`byte[]`ã‚’åœ§ç¸®ã—ã¦ã¿ã¾ã™

```c#
using System;
using System.Collections.Generic;
using System.IO;
using System.IO.Compression;
using System.Linq;

namespace CsTest
{
    class Program
    {
        static byte[] CompressGZip(byte[] input)
        {
            using (var ms = new MemoryStream())
            {
                using (var compressStream = new GZipStream(ms, CompressionMode.Compress))
                    compressStream.Write(input, 0, input.Length);
                return ms.ToArray();
            }
        }
        static byte[] CompressDeflate(byte[] input)
        {
            using (var ms = new MemoryStream())
            {
                using (var compressStream = new DeflateStream(ms, CompressionMode.Compress))
                    compressStream.Write(input, 0, input.Length);
                return ms.ToArray();
            }
        }
        static void Main(string[] args)
        {
            var random = new Random(0);
            var binaries = new byte[][]{
                Enumerable.Range(0, 200).Select(i => (byte)i).ToArray(),
                Enumerable.Range(0, 100).SelectMany(i => new byte[]{ 0, (byte)i }).ToArray(),
                Enumerable.Repeat(0, 200).Select(_ => (byte)random.Next(byte.MaxValue)).ToArray(),
                Enumerable.Repeat(new byte[]{ 0, 20, 250, 24 }, 50).SelectMany(b => b).ToArray(),
            };

            foreach (var binary in binaries)
            {
                var gzResult = CompressGZip(binary);
                var deflateResult = CompressDeflate(binary);
                Console.WriteLine($"Original Length:{binary.Length} GZip Length: {gzResult.Length,3} Deflate Lengths: {deflateResult.Length,3}");
            }
        }
    }
}
```

## å®Ÿè¡Œçµæœ

ä»¥ä¸‹ã®ã‚ˆã†ã«åœ§ç¸®çµæœã«å·®ãŒå‡ºã¾ã—ãŸã€‚

### 3.5

```text
Original Length:200 GZip Length: 416 Deflate Lengths: 398
Original Length:200 GZip Length: 434 Deflate Lengths: 416
Original Length:200 GZip Length: 432 Deflate Lengths: 414
Original Length:200 GZip Length: 130 Deflate Lengths: 112
```

ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯

- .NET Framework 3.5

ã§ç¢ºèª

### 4.5ä»¥é™

```text
Original Length:200 GZip Length: 223 Deflate Lengths: 205
Original Length:200 GZip Length: 157 Deflate Lengths: 139
Original Length:200 GZip Length: 223 Deflate Lengths: 205
Original Length:200 GZip Length:  27 Deflate Lengths:   9
```

ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯

- .NET Framework 4.7.2
- .NET Core 2.2

ã§ç¢ºèª

## åŸå› 

> ä»¥é™ã§ã¯ã€ .NET Framework 4.5ã€DeflateStreamã‚¯ãƒ©ã‚¹ã¯ã€zlib ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã—ã¦åœ§ç¸®ã—ã¾ã™ã€‚ ãã®çµæœã€ã‚ˆã‚Šå„ªã‚ŒãŸåœ§ç¸®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’åˆ©ç”¨ã§ãã€ã»ã¨ã‚“ã©ã®å ´åˆã€.NET Framework ã®ä»¥å‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ã‚‚ã®ã«æ¯”ã¹ã¦ã€ã‚ˆã‚Šå°ã•ãåœ§ç¸®ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã«ãªã‚Šã¾ã™ã€‚ 
> Starting with the .NET Framework 4.5.NET Framework 4.5, the DeflateStream class uses the zlib library for compression. As a result, it provides a better compression algorithm and, in most cases, a smaller compressed file than it provides in earlier versions of the .NET Framework.

https://docs.microsoft.com/ja-jp/dotnet/api/system.io.compression.gzipstream?view=netframework-4.7.2

å…¬å¼ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«æ›¸ã„ã¦ã‚ã‚‹ã¨ãŠã‚Šã§ã™ãŒã€4.5ä»¥é™ã‹ã‚‰ã¯zlibã‚’ä½¿ã£ã¦ã„ã‚‹ãŸã‚ã§ã™ã€‚

## å‚™è€ƒ

ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãŒ.NET 4.0ã ã£ãŸå ´åˆã¯ã€å®Ÿè¡Œå´ãŒ.NET 4.5ä»¥é™ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ã‚‹å ´åˆã¯.NET 4.5ä»¥é™ã§ã®å‹•ä½œã«ãªã‚‹ã®ã§zlibã«ã‚ˆã‚‹åœ§ç¸®ã«ãªã‚Šã¾ã™ã€‚4.5ä»¥é™ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã‘ã‚Œã°4.0ã®å‹•ä½œã¨ãªã‚Šzlibã§ã¯ãªã„(3.5ã¨åŒã˜)å‹•ä½œã«ãªã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚
